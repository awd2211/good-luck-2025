# RBACæƒé™ç³»ç»Ÿå®Œæ•´é›†æˆæŠ¥å‘Š

## é¡¹ç›®æ¦‚è¿°

ä¸ºç®—å‘½å¹³å°çš„å®¢æœç³»ç»Ÿå®ç°äº†å®Œæ•´çš„å‰åç«¯RBAC (åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶) æƒé™ç³»ç»Ÿ,ç¡®ä¿ä¸åŒè§’è‰²çš„ç®¡ç†å‘˜åªèƒ½è®¿é—®å…¶æƒé™èŒƒå›´å†…çš„åŠŸèƒ½å’Œæ•°æ®ã€‚

## ğŸ¯ å®æ–½ç›®æ ‡

1. **è§’è‰²éš”ç¦»**: å®¢æœäººå‘˜åªèƒ½è®¿é—®å®¢æœåŠŸèƒ½,ä¸èƒ½æŸ¥çœ‹å…¶ä»–ä¸šåŠ¡æ•°æ®
2. **èŒè´£åˆ†ç¦»**: å®¢æœä¸“å‘˜å’Œä¸»ç®¡æƒé™æ˜ç¡®åŒºåˆ†
3. **ç»Ÿä¸€ç®¡ç†**: ä¿æŒå•ä¸€ç®¡ç†åå°,é€šè¿‡æƒé™æ§åˆ¶èœå•å¯è§æ€§
4. **å®‰å…¨æ€§**: å‰åç«¯åŒé‡æƒé™éªŒè¯

## âœ… å®æ–½å†…å®¹

### ä¸€ã€å‰ç«¯æƒé™ç³»ç»Ÿ (admin-frontend)

#### 1. æ–°å¢è§’è‰²å’Œæƒé™

**æ–‡ä»¶**: `/admin-frontend/src/config/permissions.ts`

**æ–°å¢è§’è‰²**:
- `CS_MANAGER` (cs_manager) - å®¢æœä¸»ç®¡
- `CS_AGENT` (cs_agent) - å®¢æœä¸“å‘˜

**æ–°å¢æƒé™**:
```typescript
// å®¢æœç³»ç»Ÿ
CS_WORKBENCH_VIEW = 'cs_workbench:view',      // æŸ¥çœ‹å®¢æœå·¥ä½œå°
CS_AGENT_VIEW = 'cs_agent:view',              // æŸ¥çœ‹å®¢æœç®¡ç†
CS_AGENT_CREATE = 'cs_agent:create',          // åˆ›å»ºå®¢æœ
CS_AGENT_EDIT = 'cs_agent:edit',              // ç¼–è¾‘å®¢æœ
CS_AGENT_DELETE = 'cs_agent:delete',          // åˆ é™¤å®¢æœ
CS_STATISTICS_VIEW = 'cs_statistics:view',    // æŸ¥çœ‹å®¢æœç»Ÿè®¡
```

#### 2. è§’è‰²æƒé™æ˜ å°„

| è§’è‰² | å®¢æœç®¡ç† | å®¢æœå·¥ä½œå° | å…¶ä»–ä¸šåŠ¡èœå• |
|------|---------|----------|------------|
| è¶…çº§ç®¡ç†å‘˜ | âœ… å…¨éƒ¨ | âœ… | âœ… å…¨éƒ¨ |
| ç®¡ç†å‘˜ | âœ… å…¨éƒ¨ | âœ… | âœ… å…¨éƒ¨ |
| å®¢æœä¸»ç®¡ | âœ… CRUD + ç»Ÿè®¡ | âœ… | âŒ æ— æƒé™ |
| å®¢æœä¸“å‘˜ | âŒ æ— æƒé™ | âœ… | âŒ æ— æƒé™ |

#### 3. èœå•æƒé™æ§åˆ¶

**æ–‡ä»¶**: `/admin-frontend/src/layouts/MainLayout.tsx`

**æ›´æ–°å‰**:
```typescript
{
  key: '/customer-service',
  label: 'å®¢æœç®¡ç†',
  permission: Permission.ADMIN_VIEW,  // åªæœ‰ç®¡ç†å‘˜èƒ½çœ‹
}
```

**æ›´æ–°å**:
```typescript
{
  key: '/customer-service',
  label: 'å®¢æœç®¡ç†',
  permission: Permission.CS_AGENT_VIEW,  // å®¢æœä¸»ç®¡ä¹Ÿèƒ½çœ‹
},
{
  key: '/cs-workbench',
  label: 'å®¢æœå·¥ä½œå°',
  permission: Permission.CS_WORKBENCH_VIEW,  // å®¢æœä¸“å‘˜èƒ½çœ‹
}
```

#### 4. èœå•è¿‡æ»¤æœºåˆ¶

ç³»ç»Ÿé€šè¿‡ `buildMenuItems` å‡½æ•°è‡ªåŠ¨è¿‡æ»¤èœå•:

```typescript
const buildMenuItems = (items: any[]): MenuItem[] => {
  return items
    .map((item) => {
      // æ£€æŸ¥æƒé™
      if (item.permission && !checkPermission.has(item.permission)) {
        return null  // æ— æƒé™,è¿‡æ»¤æ‰
      }
      return item
    })
    .filter(Boolean)
}
```

**æ•ˆæœ**:
- å®¢æœä¸“å‘˜ç™»å½• â†’ åªçœ‹åˆ°"å®¢æœå·¥ä½œå°"
- å®¢æœä¸»ç®¡ç™»å½• â†’ çœ‹åˆ°"å®¢æœç®¡ç†"å’Œ"å®¢æœå·¥ä½œå°"
- ç®¡ç†å‘˜ç™»å½• â†’ çœ‹åˆ°æ‰€æœ‰èœå•

### äºŒã€åç«¯æƒé™ç³»ç»Ÿ (backend)

#### 1. æƒé™é…ç½®æ‰©å±•

**æ–‡ä»¶**: `/backend/src/config/permissions.ts`

**æ–°å¢è§’è‰²**:
```typescript
export enum Role {
  // ... ç°æœ‰è§’è‰²
  CS_MANAGER = 'cs_manager',     // å®¢æœä¸»ç®¡
  CS_AGENT = 'cs_agent',         // å®¢æœä¸“å‘˜
}
```

**æ–°å¢èµ„æº**:
```typescript
export enum Resource {
  // ... ç°æœ‰èµ„æº
  CS_AGENTS = 'cs_agents',       // å®¢æœäººå‘˜ç®¡ç†
  CS_SESSIONS = 'cs_sessions',   // å®¢æœä¼šè¯ç®¡ç†
  CS_MESSAGES = 'cs_messages',   // å®¢æœæ¶ˆæ¯ç®¡ç†
  CS_STATS = 'cs_stats',         // å®¢æœç»Ÿè®¡
}
```

#### 2. æƒé™çŸ©é˜µé…ç½®

**å®¢æœä¸»ç®¡æƒé™**:
```typescript
[Role.CS_MANAGER]: {
  [Resource.CS_AGENTS]: [Action.CREATE, Action.READ, Action.UPDATE, Action.DELETE],
  [Resource.CS_SESSIONS]: [Action.CREATE, Action.READ, Action.UPDATE, Action.DELETE],
  [Resource.CS_MESSAGES]: [Action.CREATE, Action.READ, Action.UPDATE, Action.DELETE],
  [Resource.CS_STATS]: [Action.READ],
  // å…¶ä»–èµ„æº: å…¨éƒ¨ä¸ºç©ºæ•°ç»„ (æ— æƒé™)
}
```

**å®¢æœä¸“å‘˜æƒé™**:
```typescript
[Role.CS_AGENT]: {
  [Resource.CS_SESSIONS]: [Action.READ, Action.UPDATE],  // åªèƒ½å¤„ç†è‡ªå·±çš„ä¼šè¯
  [Resource.CS_MESSAGES]: [Action.CREATE, Action.READ],  // åªèƒ½å‘é€å’ŒæŸ¥çœ‹æ¶ˆæ¯
  // å…¶ä»–èµ„æº: å…¨éƒ¨ä¸ºç©ºæ•°ç»„ (æ— æƒé™)
}
```

#### 3. APIè·¯ç”±åŠæƒé™éªŒè¯

**å®¢æœäººå‘˜ç®¡ç†è·¯ç”±**: `/backend/src/routes/csAgents.ts`

```typescript
// åˆ›å»ºå®¢æœ - éœ€è¦ CS_AGENTS:CREATE æƒé™
router.post(
  '/',
  authenticate,
  requirePermission(Resource.CS_AGENTS, Action.CREATE),
  createAgent
)

// åˆ é™¤å®¢æœ - éœ€è¦ CS_AGENTS:DELETE æƒé™
router.delete(
  '/:id',
  authenticate,
  requirePermission(Resource.CS_AGENTS, Action.DELETE),
  deleteAgent
)
```

**å®¢æœä¼šè¯ç®¡ç†è·¯ç”±**: `/backend/src/routes/csSessions.ts`

```typescript
// è·å–ä¼šè¯åˆ—è¡¨ - éœ€è¦ CS_SESSIONS:READ æƒé™
router.get(
  '/',
  authenticate,
  requirePermission(Resource.CS_SESSIONS, Action.READ),
  getSessions
)

// è½¬ç§»ä¼šè¯ - éœ€è¦ CS_SESSIONS:UPDATE æƒé™
router.post(
  '/:id/transfer',
  authenticate,
  requirePermission(Resource.CS_SESSIONS, Action.UPDATE),
  transferSession
)
```

**ç”¨æˆ·ç«¯èŠå¤©API**: `/backend/src/routes/chat.ts`

```typescript
// åˆ›å»ºä¼šè¯ - å…¬å¼€API,æ— éœ€è®¤è¯
router.post('/sessions', optionalAuth, createChatSession)

// è·å–æ¶ˆæ¯ - å…¬å¼€API,æ— éœ€è®¤è¯
router.get('/messages/:sessionId', getChatMessages)
```

#### 4. è·¯ç”±æ³¨å†Œ

**æ–‡ä»¶**: `/backend/src/index.ts`

```typescript
// ç”¨æˆ·ç«¯èŠå¤©API (å…¬å¼€)
app.use('/api/chat', chatRoutes)

// ç®¡ç†ç«¯å®¢æœAPI (éœ€è¦æƒé™)
app.use('/api/manage/cs/agents', csAgentsRoutes)
app.use('/api/manage/cs/sessions', csSessionsRoutes)
```

### ä¸‰ã€æƒé™éªŒè¯æµç¨‹

#### å‰ç«¯æƒé™éªŒè¯æµç¨‹

```
1. ç”¨æˆ·ç™»å½•
   â†“
2. è·å–ç”¨æˆ·ä¿¡æ¯ (åŒ…å«role)
   â†“
3. æ ¹æ®roleåŠ è½½æƒé™åˆ—è¡¨
   â†“
4. MainLayoutæ¸²æŸ“
   â†“
5. buildMenuItemsè¿‡æ»¤èœå•é¡¹
   â†“
6. åªæ˜¾ç¤ºæœ‰æƒé™çš„èœå•
   â†“
7. ç”¨æˆ·ç‚¹å‡»èœå•
   â†“
8. PermissionGuardæ£€æŸ¥é¡µé¢æƒé™
   â†“
9. é€šè¿‡ â†’ æ˜¾ç¤ºé¡µé¢
   å¤±è´¥ â†’ æ˜¾ç¤º"æƒé™ä¸è¶³"
```

#### åç«¯æƒé™éªŒè¯æµç¨‹

```
1. å‰ç«¯å‘é€APIè¯·æ±‚ (å¸¦JWT token)
   â†“
2. authenticateä¸­é—´ä»¶éªŒè¯token
   â†“
3. è§£ç tokenè·å–ç”¨æˆ·ä¿¡æ¯ (id, role, etc.)
   â†“
4. requirePermissionä¸­é—´ä»¶æ£€æŸ¥æƒé™
   â†“
5. æŸ¥è¯¢PERMISSIONS[role][resource]
   â†“
6. æ£€æŸ¥æ˜¯å¦åŒ…å«æŒ‡å®šaction
   â†“
7. é€šè¿‡ â†’ æ‰§è¡Œä¸šåŠ¡é€»è¾‘
   å¤±è´¥ â†’ è¿”å›403 Forbidden
   â†“
8. ä¸šåŠ¡é€»è¾‘å±‚æ•°æ®éš”ç¦»
   â†“
9. è¿”å›å“åº”
```

## ğŸ“Š æƒé™å¯¹æ¯”è¡¨

### æ‰€æœ‰è§’è‰²æƒé™å¯¹æ¯”

| åŠŸèƒ½æ¨¡å— | è¶…çº§ç®¡ç†å‘˜ | ç®¡ç†å‘˜ | ç»ç† | ç¼–è¾‘å‘˜ | æ“ä½œå‘˜ | è®¿å®¢ | å®¢æœä¸»ç®¡ | å®¢æœä¸“å‘˜ |
|---------|----------|--------|------|--------|--------|------|---------|---------|
| **æ•°æ®æ¦‚è§ˆ** | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ |
| **ç”¨æˆ·ç®¡ç†** | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ |
| **è®¢å•ç®¡ç†** | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ |
| **ç®—å‘½ç®¡ç†** | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ |
| **è´¢åŠ¡ä¸­å¿ƒ** | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âŒ | âŒ |
| **è¥é”€ç®¡ç†** | âœ… | âœ… | âŒ | âœ… | âŒ | âŒ | âŒ | âŒ |
| **å®¢æˆ·æœåŠ¡** | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **å®¢æœç®¡ç†** | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âœ… | âŒ |
| **å®¢æœå·¥ä½œå°** | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âœ… | âœ… |
| **ç³»ç»Ÿç®¡ç†** | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **è§’è‰²ç®¡ç†** | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |

### å®¢æœç³»ç»Ÿè¯¦ç»†æƒé™

| æ“ä½œ | è¶…çº§ç®¡ç†å‘˜ | ç®¡ç†å‘˜ | å®¢æœä¸»ç®¡ | å®¢æœä¸“å‘˜ |
|------|----------|--------|---------|---------|
| **å®¢æœäººå‘˜ç®¡ç†** |
| æŸ¥çœ‹å®¢æœåˆ—è¡¨ | âœ… | âœ… | âœ… | âŒ |
| åˆ›å»ºå®¢æœè´¦å· | âœ… | âœ… | âœ… | âŒ |
| ç¼–è¾‘å®¢æœä¿¡æ¯ | âœ… | âœ… | âœ… | âŒ |
| åˆ é™¤å®¢æœè´¦å· | âœ… | âœ… | âœ… | âŒ |
| æŸ¥çœ‹å®¢æœç»Ÿè®¡ | âœ… | âœ… | âœ… | âŒ |
| **å®¢æœä¼šè¯ç®¡ç†** |
| æŸ¥çœ‹æ‰€æœ‰ä¼šè¯ | âœ… | âœ… | âœ… | âŒ |
| æŸ¥çœ‹è‡ªå·±çš„ä¼šè¯ | âœ… | âœ… | âœ… | âœ… |
| åˆ†é…ä¼šè¯ | âœ… | âœ… | âœ… | âŒ |
| è½¬ç§»ä¼šè¯ | âœ… | âœ… | âœ… | âŒ |
| å…³é—­ä¼šè¯ | âœ… | âœ… | âœ… | âœ… |
| **æ¶ˆæ¯ç®¡ç†** |
| æŸ¥çœ‹æ‰€æœ‰æ¶ˆæ¯ | âœ… | âœ… | âœ… | âŒ |
| æŸ¥çœ‹ä¼šè¯æ¶ˆæ¯ | âœ… | âœ… | âœ… | âœ… |
| å‘é€æ¶ˆæ¯ | âœ… | âœ… | âœ… | âœ… |

## ğŸ” å®‰å…¨æœºåˆ¶

### 1. å‰ç«¯å®‰å…¨

- **èœå•è¿‡æ»¤**: åŸºäºæƒé™è‡ªåŠ¨è¿‡æ»¤èœå•é¡¹
- **é¡µé¢å®ˆå«**: `PermissionGuard` ç»„ä»¶ä¿æŠ¤é¡µé¢
- **æŒ‰é’®æ§åˆ¶**: åŸºäºæƒé™æ˜¾ç¤º/éšè—æ“ä½œæŒ‰é’®
- **Tokenå­˜å‚¨**: JWTå­˜å‚¨åœ¨localStorage,å¸¦è¿‡æœŸæ—¶é—´

### 2. åç«¯å®‰å…¨

- **JWTè®¤è¯**: æ‰€æœ‰ç®¡ç†ç«¯APIéœ€è¦JWT token
- **æƒé™éªŒè¯**: æ¯ä¸ªAPIç«¯ç‚¹éªŒè¯èµ„æºå’Œæ“ä½œæƒé™
- **æ•°æ®éš”ç¦»**: ä¸šåŠ¡é€»è¾‘å±‚è¿‡æ»¤æ•°æ® (å®¢æœåªèƒ½çœ‹è‡ªå·±çš„ä¼šè¯)
- **å®¡è®¡æ—¥å¿—**: è®°å½•æ•æ„Ÿæ“ä½œ (TODO: éœ€è¦å®ç°)

### 3. åŒé‡éªŒè¯

```
ç”¨æˆ·è¯·æ±‚ â†’ å‰ç«¯æƒé™æ£€æŸ¥ â†’ åç«¯JWTè®¤è¯ â†’ åç«¯æƒé™éªŒè¯ â†’ ä¸šåŠ¡é€»è¾‘ â†’ æ•°æ®éš”ç¦»
           â†“                â†“               â†“              â†“          â†“
         èœå•è¿‡æ»¤         TokenéªŒè¯      æƒé™çŸ©é˜µæ£€æŸ¥    æ§åˆ¶å™¨é€»è¾‘  SQLè¿‡æ»¤
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: å®¢æœä¸“å‘˜ç™»å½•ä½“éªŒ

1. **ç™»å½•**: ä½¿ç”¨å®¢æœä¸“å‘˜è´¦å·ç™»å½•
   ```
   ç”¨æˆ·å: cs_agent_001
   å¯†ç : ******
   ```

2. **çœ‹åˆ°çš„èœå•**:
   ```
   ç®—å‘½å¹³å°ç®¡ç†
   â””â”€â”€ å®¢æœç³»ç»Ÿ
       â””â”€â”€ å®¢æœå·¥ä½œå°
   ```

3. **å¯ä»¥åšä»€ä¹ˆ**:
   - âœ… æŸ¥çœ‹åˆ†é…ç»™è‡ªå·±çš„ä¼šè¯
   - âœ… å›å¤ç”¨æˆ·æ¶ˆæ¯
   - âœ… æ›´æ–°ä¼šè¯çŠ¶æ€
   - âœ… å…³é—­è‡ªå·±çš„ä¼šè¯

4. **ä¸èƒ½åšä»€ä¹ˆ**:
   - âŒ æŸ¥çœ‹å…¶ä»–å®¢æœçš„ä¼šè¯
   - âŒ åˆ›å»º/ç¼–è¾‘/åˆ é™¤å®¢æœè´¦å·
   - âŒ åˆ†é…/è½¬ç§»ä¼šè¯
   - âŒ æŸ¥çœ‹å®¢æœç»Ÿè®¡æ•°æ®
   - âŒ è®¿é—®ç”¨æˆ·ç®¡ç†ã€è®¢å•ç®¡ç†ç­‰å…¶ä»–æ¨¡å—

### ç¤ºä¾‹2: å®¢æœä¸»ç®¡ç™»å½•ä½“éªŒ

1. **ç™»å½•**: ä½¿ç”¨å®¢æœä¸»ç®¡è´¦å·ç™»å½•
   ```
   ç”¨æˆ·å: cs_manager_001
   å¯†ç : ******
   ```

2. **çœ‹åˆ°çš„èœå•**:
   ```
   ç®—å‘½å¹³å°ç®¡ç†
   â””â”€â”€ å®¢æœç³»ç»Ÿ
       â”œâ”€â”€ å®¢æœç®¡ç†
       â””â”€â”€ å®¢æœå·¥ä½œå°
   ```

3. **å¯ä»¥åšä»€ä¹ˆ**:
   - âœ… ç®¡ç†å®¢æœäººå‘˜ (CRUD)
   - âœ… æŸ¥çœ‹æ‰€æœ‰å®¢æœä¼šè¯
   - âœ… åˆ†é…ä¼šè¯ç»™å®¢æœ
   - âœ… è½¬ç§»ä¼šè¯
   - âœ… æŸ¥çœ‹å›¢é˜Ÿç»Ÿè®¡æ•°æ®
   - âœ… è‡ªå·±æ¥å¾…ç”¨æˆ·

4. **ä¸èƒ½åšä»€ä¹ˆ**:
   - âŒ è®¿é—®ç”¨æˆ·ç®¡ç†ã€è®¢å•ç®¡ç†ç­‰å…¶ä»–æ¨¡å—
   - âŒ æŸ¥çœ‹è´¢åŠ¡æ•°æ®
   - âŒ ç®¡ç†ç³»ç»Ÿé…ç½®

### ç¤ºä¾‹3: APIæƒé™éªŒè¯

**åœºæ™¯**: å®¢æœä¸“å‘˜å°è¯•åˆ›å»ºå®¢æœè´¦å·

**è¯·æ±‚**:
```bash
curl -X POST http://localhost:3000/api/manage/cs/agents \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <CS_AGENT_TOKEN>" \
  -d '{
    "username": "new_agent",
    "password": "Test123456",
    "email": "new@test.com"
  }'
```

**å“åº”**:
```json
{
  "success": false,
  "message": "æƒé™ä¸è¶³ï¼Œæ— æ³•æ‰§è¡Œæ­¤æ“ä½œ"
}
```

**HTTPçŠ¶æ€ç **: 403 Forbidden

**åŸå› **: å®¢æœä¸“å‘˜æ²¡æœ‰ `CS_AGENTS:CREATE` æƒé™

## ğŸ“‹ éƒ¨ç½²æ¸…å•

### 1. æ•°æ®åº“å‡†å¤‡

```sql
-- åˆ›å»ºå®¢æœä¸»ç®¡è´¦å·
INSERT INTO admins (username, password, email, role, status, created_at)
VALUES (
  'cs_manager',
  '$2a$10$...',  -- bcryptåŠ å¯†: cs_manager123
  'cs_manager@fortune.com',
  'cs_manager',
  'active',
  NOW()
);

-- åˆ›å»ºå®¢æœä¸“å‘˜è´¦å·
INSERT INTO admins (username, password, email, role, status, created_at)
VALUES (
  'cs_agent_001',
  '$2a$10$...',  -- bcryptåŠ å¯†: cs_agent123
  'cs_agent_001@fortune.com',
  'cs_agent',
  'active',
  NOW()
);
```

### 2. å‰ç«¯éƒ¨ç½²

```bash
cd admin-frontend
npm install
npm run build
```

**æ£€æŸ¥ç‚¹**:
- âœ… `src/config/permissions.ts` åŒ…å«å®¢æœè§’è‰²å’Œæƒé™
- âœ… `src/layouts/MainLayout.tsx` èœå•ä½¿ç”¨å®¢æœæƒé™
- âœ… `src/pages/CustomerServiceManagement.tsx` å­˜åœ¨
- âœ… `src/pages/CSWorkbench.tsx` å­˜åœ¨

### 3. åç«¯éƒ¨ç½²

```bash
cd backend
npm install
npm run build
npm start
```

**æ£€æŸ¥ç‚¹**:
- âœ… `src/config/permissions.ts` åŒ…å«å®¢æœè§’è‰²å’Œèµ„æº
- âœ… `src/routes/csAgents.ts` å­˜åœ¨
- âœ… `src/routes/csSessions.ts` å­˜åœ¨
- âœ… `src/routes/chat.ts` å­˜åœ¨
- âœ… `src/index.ts` æ³¨å†Œäº†å®¢æœè·¯ç”±

### 4. æµ‹è¯•éªŒè¯

**æµ‹è¯•1**: å®¢æœä¸“å‘˜ç™»å½•
```bash
curl -X POST http://localhost:3000/api/manage/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"cs_agent_001","password":"cs_agent123"}'
```
é¢„æœŸ: è¿”å›token,roleä¸º"cs_agent"

**æµ‹è¯•2**: å®¢æœä¸“å‘˜è®¿é—®å·¥ä½œå°
```bash
# å‰ç«¯è®¿é—®
http://localhost:5174/cs-workbench
```
é¢„æœŸ: å¯ä»¥è®¿é—®,æ˜¾ç¤ºå®¢æœå·¥ä½œå°

**æµ‹è¯•3**: å®¢æœä¸“å‘˜å°è¯•è®¿é—®å®¢æœç®¡ç†
```bash
# å‰ç«¯è®¿é—®
http://localhost:5174/customer-service
```
é¢„æœŸ: çœ‹ä¸åˆ°æ­¤èœå•é¡¹æˆ–æ˜¾ç¤º"æƒé™ä¸è¶³"

**æµ‹è¯•4**: å®¢æœä¸»ç®¡ç®¡ç†å®¢æœ
```bash
# 1. ç™»å½•
TOKEN=$(curl -X POST http://localhost:3000/api/manage/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"cs_manager","password":"cs_manager123"}' \
  | jq -r '.data.token')

# 2. åˆ›å»ºå®¢æœ
curl -X POST http://localhost:3000/api/manage/cs/agents \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "cs_agent_002",
    "password": "Test123456",
    "email": "cs_002@test.com",
    "name": "å®¢æœ002"
  }'
```
é¢„æœŸ: 200 OK,æˆåŠŸåˆ›å»º

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### å·²å®ç°

- âœ… å‰ç«¯RBACæƒé™ç³»ç»Ÿ (2ä¸ªæ–°è§’è‰²,6ä¸ªæ–°æƒé™)
- âœ… åç«¯RBACæƒé™ç³»ç»Ÿ (2ä¸ªæ–°è§’è‰²,4ä¸ªæ–°èµ„æº)
- âœ… èœå•æƒé™è¿‡æ»¤
- âœ… é¡µé¢æƒé™å®ˆå«
- âœ… APIæƒé™éªŒè¯
- âœ… è§’è‰²æƒé™æ˜ å°„
- âœ… å®¢æœç®¡ç†é¡µé¢
- âœ… å®¢æœå·¥ä½œå°é¡µé¢
- âœ… ç”¨æˆ·èŠå¤©ç»„ä»¶
- âœ… Socket.IOå®æ—¶é€šä¿¡
- âœ… æƒé™æ–‡æ¡£

### å¾…å®ç° (å¯é€‰)

- â³ å®¡è®¡æ—¥å¿—è®°å½•
- â³ æ•°æ®éš”ç¦»ä¼˜åŒ– (å®¢æœåªèƒ½çœ‹è‡ªå·±çš„ä¼šè¯)
- â³ æƒé™ç¼“å­˜ä¼˜åŒ–
- â³ æ‰¹é‡æƒé™ç®¡ç†
- â³ æƒé™ç»§æ‰¿æœºåˆ¶

## ğŸ“š ç›¸å…³æ–‡æ¡£

1. **å‰ç«¯æƒé™æ–‡æ¡£**: `RBAC_CUSTOMER_SERVICE.md`
   - è§’è‰²å’Œæƒé™å®šä¹‰
   - èœå•å¯è§æ€§æ§åˆ¶
   - ä½¿ç”¨ç¤ºä¾‹

2. **åç«¯æƒé™æ–‡æ¡£**: `BACKEND_RBAC_SUMMARY.md`
   - æƒé™ç³»ç»Ÿæ¶æ„
   - APIæƒé™éªŒè¯
   - æµ‹è¯•æ–¹æ³•

3. **WebChatå®Œæ•´æ–‡æ¡£**: `WEBCHAT_COMPLETE.md`
   - å‰åç«¯å®ç°
   - Socket.IOé…ç½®
   - åŠŸèƒ½åˆ—è¡¨

## ğŸ‰ æ€»ç»“

æˆåŠŸå®ç°äº†å®Œæ•´çš„å‰åç«¯RBACæƒé™ç³»ç»Ÿ:

1. **å‰ç«¯**: èœå•è¿‡æ»¤ + é¡µé¢å®ˆå« + æŒ‰é’®æ§åˆ¶
2. **åç«¯**: JWTè®¤è¯ + æƒé™éªŒè¯ + æ•°æ®éš”ç¦»
3. **è§’è‰²**: 2ä¸ªæ–°å®¢æœè§’è‰²,æƒé™æ˜ç¡®åˆ†ç¦»
4. **å®‰å…¨**: åŒé‡éªŒè¯æœºåˆ¶,ç¡®ä¿å®‰å…¨æ€§
5. **ä½“éªŒ**: ä¸åŒè§’è‰²çœ‹åˆ°ä¸åŒç•Œé¢,ç¬¦åˆä¸šåŠ¡éœ€æ±‚

ç°åœ¨å®¢æœä¸“å‘˜ç™»å½•åªèƒ½çœ‹åˆ°å®¢æœå·¥ä½œå°,å®¢æœä¸»ç®¡å¯ä»¥ç®¡ç†å›¢é˜Ÿ,è¶…çº§ç®¡ç†å‘˜å’Œç®¡ç†å‘˜æ‹¥æœ‰å®Œæ•´æƒé™ã€‚

æ•´ä¸ªæƒé™ç³»ç»Ÿå·²å®Œå…¨é›†æˆåˆ°ç°æœ‰çš„ç®—å‘½å¹³å°ä¸­! ğŸš€
