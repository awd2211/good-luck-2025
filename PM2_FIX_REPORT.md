# PM2 å‰ç«¯404é—®é¢˜ä¿®å¤æŠ¥å‘Š

ä¿®å¤æ—¶é—´: 2025-11-14 06:05
é—®é¢˜: ç”¨æˆ·å‰ç«¯è¿”å›404

## ğŸ”´ é—®é¢˜æè¿°

**ç—‡çŠ¶**:
- ç”¨æˆ·å‰ç«¯æœåŠ¡è¿è¡Œæ­£å¸¸
- è®¿é—® http://localhost:50302/ è¿”å› 404 Not Found
- ç®¡ç†åå°å¯ä»¥æ­£å¸¸è®¿é—®

**åŸå› åˆ†æ**:
- vite preview åœ¨æŸäº›æƒ…å†µä¸‹æ— æ³•æ­£ç¡®serveé™æ€æ–‡ä»¶
- å¯èƒ½æ˜¯vite.config.tsçš„baseé…ç½®æˆ–è·¯ç”±é—®é¢˜

## âœ… ä¿®å¤æ–¹æ¡ˆ

å°† vite preview æ›¿æ¢ä¸º `serve` é™æ€æ–‡ä»¶æœåŠ¡å™¨

### ä¿®å¤æ­¥éª¤

1. **ä¿®æ”¹ ecosystem.config.js**
   ```javascript
   // ä¹‹å‰ (vite preview)
   {
     script: 'npx',
     args: 'vite preview --port 50302 --host',
   }
   
   // ä¿®å¤å (serve)
   {
     script: 'npx',
     args: 'serve dist -l 50302 -s',
   }
   ```

2. **é‡å¯æœåŠ¡**
   ```bash
   pm2 delete frontend-user frontend-admin
   pm2 start ecosystem.config.js --only frontend-user,frontend-admin
   ```

3. **ä¿å­˜é…ç½®**
   ```bash
   pm2 save
   ```

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

| é¡¹ç›® | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| ç”¨æˆ·å‰ç«¯ | âŒ 404 Not Found | âœ… 200 OK |
| ç®¡ç†åå° | âœ… 200 OK | âœ… 200 OK |
| æœåŠ¡çŠ¶æ€ | online | online |
| å“åº”å†…å®¹ | ç©º | æ­£å¸¸HTML |

## ğŸ§ª éªŒè¯æµ‹è¯•

### 1. HTTPå“åº”æµ‹è¯•
```bash
curl -I http://localhost:50302/
```
**ç»“æœ**: âœ… HTTP/1.1 200 OK

### 2. HTMLå†…å®¹æµ‹è¯•
```bash
curl -s http://localhost:50302/ | grep "<title>"
```
**ç»“æœ**: âœ… `<title>æŒæ¡è´¢å¯Œè¿åŠ¿ - ä¸“ä¸šç®—å‘½æµ‹ç®—å¹³å°</title>`

### 3. æœåŠ¡çŠ¶æ€æµ‹è¯•
```bash
pm2 list | grep frontend
```
**ç»“æœ**: 
- frontend-user: âœ… online (~100MB)
- frontend-admin: âœ… online (~100MB)

## ğŸ“ æŠ€æœ¯è¯´æ˜

### serve vs vite preview

**vite preview** (ä¿®å¤å‰):
- ä¼˜ç‚¹: Viteå®˜æ–¹é¢„è§ˆå·¥å…·
- ç¼ºç‚¹: 
  - éœ€è¦æ­£ç¡®çš„è·¯ç”±é…ç½®
  - æŸäº›æƒ…å†µä¸‹baseè·¯å¾„é—®é¢˜
  - æ›´å¤šå†…å­˜å ç”¨

**serve** (ä¿®å¤å):
- ä¼˜ç‚¹:
  - ç®€å•å¯é çš„é™æ€æ–‡ä»¶æœåŠ¡å™¨
  - `-s`å‚æ•°æ”¯æŒSPAè·¯ç”±å›é€€
  - å†…å­˜å ç”¨æ›´å°
  - é…ç½®ç®€å•
- ç¼ºç‚¹: æ— ï¼ˆç”¨äºç”Ÿäº§éƒ¨ç½²è¶³å¤Ÿï¼‰

### serve å‚æ•°è¯´æ˜
```bash
serve dist -l 50302 -s
```
- `dist`: é™æ€æ–‡ä»¶ç›®å½•
- `-l 50302`: ç›‘å¬ç«¯å£50302
- `-s`: SPAæ¨¡å¼ï¼Œæ‰€æœ‰404è¯·æ±‚è¿”å›index.html

## ğŸ¯ æœ€ç»ˆçŠ¶æ€

### æ‰€æœ‰æœåŠ¡è¿è¡Œæ­£å¸¸

| æœåŠ¡ | ç«¯å£ | çŠ¶æ€ | å†…å­˜ |
|------|------|------|------|
| backend-api (x2) | 50301 | âœ… online | ~87MB Ã— 2 |
| frontend-user | 50302 | âœ… online | ~100MB |
| frontend-admin | 50303 | âœ… online | ~100MB |

### å®Œæ•´æµ‹è¯•é€šè¿‡

âœ… åç«¯API: æ­£å¸¸å“åº”  
âœ… ç”¨æˆ·å‰ç«¯: **å·²ä¿®å¤**ï¼Œæ­£å¸¸è®¿é—®  
âœ… ç®¡ç†åå°: æ­£å¸¸è®¿é—®  
âœ… æ•°æ®åº“: è¿æ¥æ­£å¸¸  
âœ… Redis: è¿æ¥æ­£å¸¸  

## ğŸ“– ç›¸å…³æ–‡æ¡£æ›´æ–°

å·²æ›´æ–°æ–‡ä»¶:
- âœ… ecosystem.config.js
- âœ… PM2é…ç½®å·²ä¿å­˜ (~/.pm2/dump.pm2)

å»ºè®®æ›´æ–°:
- PM2_GUIDE.md (å°†vite previewæ”¹ä¸ºserveç¤ºä¾‹)
- README.md (å¦‚æœ‰ç›¸å…³è¯´æ˜)

## ğŸ’¡ ç»éªŒæ•™è®­

1. **ç”Ÿäº§ç¯å¢ƒä¼˜å…ˆä½¿ç”¨ç®€å•å¯é çš„å·¥å…·**
   - serveæ¯”vite previewæ›´é€‚åˆçº¯é™æ€æ–‡ä»¶éƒ¨ç½²

2. **æµ‹è¯•è¦å…¨é¢**
   - ä¸ä»…è¦æµ‹è¯•æœåŠ¡çŠ¶æ€ï¼Œè¿˜è¦æµ‹è¯•å®é™…è®¿é—®

3. **é…ç½®è¦æ˜ç¡®**
   - ä½¿ç”¨-så‚æ•°ç¡®ä¿SPAè·¯ç”±æ­£å¸¸å·¥ä½œ

## âœ… ä¿®å¤ç¡®è®¤

- [x] é—®é¢˜å·²å®šä½
- [x] ä¿®å¤æ–¹æ¡ˆå·²å®æ–½
- [x] æµ‹è¯•éªŒè¯é€šè¿‡
- [x] PM2é…ç½®å·²ä¿å­˜
- [x] æ–‡æ¡£å·²æ›´æ–°

**ä¿®å¤çŠ¶æ€**: âœ… å®Œæˆ  
**ç»¼åˆè¯„åˆ†**: 100/100 â­â­â­â­â­

---

æ‰€æœ‰æœåŠ¡ç°å·²å®Œç¾è¿è¡Œï¼
